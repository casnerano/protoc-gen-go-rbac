// Code generated by protoc-gen-go-rbac. DO NOT EDIT.
// versions:
// - protoc-gen-go-grpc {{ .Meta.ModuleVersion }}
// - protoc             {{ .Meta.ProtocVersion }}
// source: {{ .Package.Source }}

package {{ .Package.Name }}

import (
    "github.com/casnerano/protoc-gen-go-rbac/pkg/rbac"
    desc "github.com/casnerano/protoc-gen-go-rbac/proto"
)

var accessServices = map[string]rbac.AccessService{
    {{- range .Services }}
    "{{ .Name }}": {
        {{- if .Rules }}
            Rules: &rbac.AccessRules{
                AccessLevel: desc.AccessLevel_{{ .Rules.AccessLevel }},
                {{- if .Rules.AllowedRoles }}
                AllowedRoles: []string{
                    {{- range $i, $role := .Rules.AllowedRoles }}
                    "{{ $role | toLower }}",
                    {{- end }}
                },
                {{- end }}
            },
        {{- else }}
            Rules: nil,
        {{- end }}
        Methods: map[string]rbac.AccessMethod{
            {{- range .Methods }}
            "{{ .Name }}": {
                Rules: &rbac.AccessRules{
                    AccessLevel: desc.AccessLevel_{{ .Rules.AccessLevel }},
                    {{- if .Rules.AllowedRoles }}
                    AllowedRoles: []string{
                        {{- range $j, $role := .Rules.AllowedRoles }}
                        "{{ $role | toLower }}",
                        {{- end }}
                    },
                    {{- end }}
                },
            },
            {{- end }}
        },
    },
    {{- end }}
}

{{- range .Services }}
    func (Unimplemented{{ .Name }}Server) CheckRolesAccess(fullMethod string, roles []string) bool {
        return rbac.CheckRolesAccess(accessServices, fullMethod, roles)
    }
{{- end }}

